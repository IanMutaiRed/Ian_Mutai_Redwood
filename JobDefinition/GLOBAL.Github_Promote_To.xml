<?xml version='1.0'?>
<JobDefinition>
  <Comment />
  <Description />
  <Name>Github_Promote_To</Name>
  <Partition type="Partition" path="GLOBAL" />
  <ParentApplication type="Application" path="GLOBAL.Redwood.GLOBAL.Github.$2" />
  <EquivalentObject>false</EquivalentObject>
  <CriticalProcess>false</CriticalProcess>
  <Discarded>false</Discarded>
  <KeepForce>false</KeepForce>
  <KeepAmount />
  <KeepUnits />
  <KeepType />
  <KeepJobsInStatus />
  <KeepInStatusAmount />
  <KeepInStatusUnit />
  <MinimumOpenDurationExpression />
  <Overdue>false</Overdue>
  <OverdueStatus />
  <OverviewFormat />
  <Priority />
  <MaxPriority>100</MaxPriority>
  <RestartCount />
  <ReturncodeMapToCompleted />
  <HoldOnSubmit>false</HoldOnSubmit>
  <TopLevel>true</TopLevel>
  <Template>false</Template>
  <Maintenance>false</Maintenance>
  <ReactionJobType>Pusher</ReactionJobType>
  <EvaluationOwnerType>SystemDefault</EvaluationOwnerType>
  <CompletionStrategy>Default</CompletionStrategy>
  <OverdueEventDefinition />
  <DefaultOutputFormat />
  <JobDefinitionType type="JobDefinitionType" path="GLOBAL.RedwoodScript" />
  <DefaultLogFormat />
  <DefaultQueue type="Queue" path="GLOBAL.System" />
  <Resource />
  <TimeWindow />
  <TimeWindowTimeZone />
  <JobTimeZone />
  <RELRelatedLibrary />
  <ActionSubject />
  <JobDefinitionParameter>
    <Comment><![CDATA[The address associated with the source process server check, or the address of the Remote System]]></Comment>
    <Description>Address</Description>
    <Name>Address</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>0</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[Data associated with the current process or process server check, or location of the CAR file.]]></Comment>
    <Description>Data</Description>
    <Name>Data</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>1</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>true</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[The message associated with the source process server check]]></Comment>
    <Description>Message</Description>
    <Name>Message</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>2</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>true</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[Name of the source that initiated this process.]]></Comment>
    <Description>Source Object</Description>
    <Name>SourceObject</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>3</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[Object type of the source that initiated this process.]]></Comment>
    <Description>Source Object Type</Description>
    <Name>SourceObjectType</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>4</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[UniqueId of the source that initiated this process.]]></Comment>
    <Description>Source Object UniqueId</Description>
    <Name>SourceObjectUniqueId</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>Number</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>5</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[BusinessKey of the export rule set that contains all the objects that must be included in the generated CAR file.]]></Comment>
    <Description>Export Rule Set Business Key</Description>
    <Name>exportRuleSetBusinessKey</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>6</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[BusinessKey of the remote system that this promote should go to. The same information is available in the Source* parameters, but this is for backwards compatibility.]]></Comment>
    <Description>Remote System Business Key</Description>
    <Name>remoteSystemBusinessKey</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>7</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[Should only the CAR file be generated (false), or must it also be send to the remote system (true).]]></Comment>
    <Description>Send to Remote System</Description>
    <Name>sendToRemoteSystem</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>8</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment />
    <Description>Repository Name</Description>
    <Name>repository</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression><![CDATA[main]]></DefaultExpression>
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>9</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment />
    <Description>Branch Name</Description>
    <Name>branchName</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression><![CDATA[main]]></DefaultExpression>
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>10</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>false</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <JobDefinitionParameter>
    <Comment><![CDATA[Additional information as to why this promote is being done. E.g. an issue number, link to documentation, etc.]]></Comment>
    <Description>Comment for this promotion</Description>
    <Name>promotionComment</Name>
    <DataLength />
    <DataPrecision />
    <DataScale />
    <DataType>String</DataType>
    <DefaultExpression />
    <DefaultValueEditable />
    <Direction>In</Direction>
    <SimpleConstraintType>None</SimpleConstraintType>
    <SimpleConstraintData />
    <SimpleConstraintMessage />
    <SimpleConstraintOptional>false</SimpleConstraintOptional>
    <SimpleConstraintSort>Ascending</SimpleConstraintSort>
    <Display>true</Display>
    <Password>false</Password>
    <DisplayOrder>11</DisplayOrder>
    <Editable>Always</Editable>
    <GroupName />
    <PartOfKey>false</PartOfKey>
    <Nullable>true</Nullable>
    <Runtime>false</Runtime>
    <JobFormat />
    <Array>false</Array>
    <ArrayMinLength>0</ArrayMinLength>
    <ArrayMaxLength />
    <ArrayDuplicateValuesAllowed>false</ArrayDuplicateValuesAllowed>
    <ArraySorted>false</ArraySorted>
    <ParameterMappingType>Normal</ParameterMappingType>
    <JobDefinitionParameterSubType />
  </JobDefinitionParameter>
  <Script>
    <Source><![CDATA[import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import com.redwood.scheduler.api.export.ExportedItem;
import com.redwood.scheduler.api.model.BusinessKeyLookup;
import com.redwood.scheduler.api.model.BusinessKeyObject;
import com.redwood.scheduler.api.model.ExportRuleSet;
import com.redwood.scheduler.api.model.Exporter;
import com.redwood.scheduler.api.model.Readable;
import com.redwood.scheduler.api.model.SchedulerEntity;
import com.redwood.scheduler.api.model.SchedulerSession;
import com.redwood.scheduler.custom.github.GithubConnector;

{
    Map<String, String> objectsToCommit = new HashMap<>();
    ExportRuleSet ers = BusinessKeyLookup.getExportRuleSetByBusinessKey(jcsSession, exportRuleSetBusinessKey);
    SchedulerSession exporterSession = jcsJobContext.createSchedulerSession();
    Exporter ex = exporterSession.createExporter();
    if (ers != null)
    {
      for (Iterator<ExportedItem> it = ers.getExportedItems(); it.hasNext();)
      {
        SchedulerEntity se = it.next().getSchedulerEntity();
        if (se instanceof BusinessKeyObject)
        {
          BusinessKeyObject bko = (BusinessKeyObject) se;
          // If you want to exclude certain object types to be included, for instance partitions, Process Servers or Queues, uncomment the following line
          // if (!(bko instanceof ProcessServer) && !(bko instanceof Queue)  && !(bko instanceof Partition))
          {
            objectsToCommit.put(bko.getObjectType() + "/" + bko.getBusinessKey().getPath().toString() + ".xml", ex.getObjectXML((Readable)bko));
            jcsErr.println("Added " + ((BusinessKeyObject) se).getBusinessKey().toString() + " to Commit list");
          }
        }
      }
    }
    new GithubConnector(jcsSession.getRemoteSystemByUniqueId(Long.valueOf(SourceObjectUniqueId.longValue())), repository, jcsJob, jcsJobContext,
                        jcsOutLog).promoteTo(objectsToCommit, branchName, promotionComment);
  }
]]></Source>
    <RunAsUser />
    <RemoteRunAsUser />
    <Library type="Library" path="GLOBAL.Custom_Github" />
  </Script>
</JobDefinition>
